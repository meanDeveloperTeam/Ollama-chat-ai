<!-- ChatGPT-like UI with sidebar and chat area, now with dynamic streaming chat integration -->
<div class="container-fluid vh-100 d-flex flex-row p-0" style="height: 100vh;">
  <!-- Sidebar -->
  <div
    class="bg-light border-end h-100 overflow-hidden"
    [@sidebarCollapse]="sidebarState"
    style="will-change: width, min-width, opacity;"
  >
    <div class="d-flex flex-column h-100 p-3" *ngIf="!sidebarCollapsed()">
      <h4 class="mb-4 d-flex align-items-center">
        <i class="bi bi-chat-left-text me-2"></i> Chats
      </h4>
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item mb-2" *ngFor="let chat of chats()" (click)="loadChat(chat._id)">
          <a href="#" class="nav-link active d-flex align-items-center">
            <i class="bi bi-robot me-2"></i> {{ chat.title || 'Untitled' }}
          </a>
        </li>
        <li class="nav-item mb-2" (click)="createChat('New Chat')">
          <a href="#" class="nav-link d-flex align-items-center">
            <i class="bi bi-plus-circle me-2"></i> New Chat
          </a>
        </li>
      </ul>
      <div class="mt-auto">
        <button class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center">
          <i class="bi bi-gear me-2"></i> Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="flex-grow-1 d-flex flex-column position-relative bg-white">
    <!-- Sidebar Toggle Button -->
    <button
      class="btn btn-light position-absolute top-0 start-0 m-2 shadow-sm"
      style="z-index: 20;"
      (click)="toggleSidebar()"
      [ngClass]="{ 'ms-0': sidebarCollapsed(), 'ms-2': !sidebarCollapsed() }"
      title="Toggle sidebar"
    >
      <i class="bi" [ngClass]="sidebarCollapsed() ? 'bi-list' : 'bi-chevron-left'"></i>
    </button>
    <!-- Chat Messages (dynamic) -->
    <div class="flex-grow-1 overflow-auto p-4" style="margin-bottom: 80px;">
      <div *ngFor="let msg of messages()" class="mb-3 d-flex" [ngClass]="msg.role === 'user' ? 'justify-content-start' : 'justify-content-end'">
        <div
          [ngClass]="msg.role === 'user'
            ? 'bg-light border rounded p-3 me-auto d-flex align-items-end'
            : 'bg-secondary text-white rounded p-3 ms-auto d-flex align-items-end'"
          style="max-width: 60%;"
        >
          <ng-container *ngIf="msg.role === 'user'">
            <i class="bi bi-person-circle me-2"></i>
            <span>{{ msg.content }}</span>
          </ng-container>
          <ng-container *ngIf="msg.role === 'assistant'">
            <span class="me-2">{{ msg.content }}</span>
            <i class="bi bi-robot"></i>
          </ng-container>
        </div>
      </div>
    </div>
    <!-- Chat Input (fixed at bottom) -->
    <form class="position-absolute bottom-0 start-0 w-100 bg-white border-top p-3" style="z-index: 10;"
          (submit)="onSendMessage($event, chatInput.value)">
      <div class="input-group">
        <input #chatInput type="text" class="form-control" placeholder="Type your message..." autocomplete="off" />
        <button class="btn btn-primary d-flex align-items-center" type="submit">
          <span class="me-1">Send</span>
          <i class="bi bi-send"></i>
        </button>
      </div>
    </form>
  </div>
</div>
